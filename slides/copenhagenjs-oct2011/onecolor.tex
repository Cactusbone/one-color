\documentclass{beamer}
% vim:spelllang=en
% vim:spell
% vim:fileencoding=utf-8
% vim:textwidth=72

% Danish
\usepackage[utf8]{inputenc}
\usepackage[danish]{babel}

% Font
%\usepackage{palatino}
%\usepackage[osf]{mathpazo} % Palatino + lidt; osf=hængende numre

% Kode
\usepackage{verbatim}
\usepackage{listings}
\newcommand{\MyHookSign}{\hbox{\ensuremath\hookleftarrow}}

\usepackage{color}
\definecolor{lightgray}{rgb}{.9,.9,.9}
\definecolor{darkgray}{rgb}{.4,.4,.4}
\definecolor{purple}{rgb}{0.65, 0.12, 0.82}

% Tango colours
\definecolor{IndianRed}{RGB}{205,92,92} % IndianRed
\definecolor{SkyBlue}{RGB}{135,206,235} % SkyBlue
\definecolor{Gold}{RGB}{255,215,0} % Gold
\definecolor{MediumOrchid}{RGB}{186,85,211} % MediumOrchid
\definecolor{Silver}{RGB}{192,192,192} % Silver
\definecolor{OliveDrab}{RGB}{107,142,35} % OliveDrab

\lstdefinelanguage{JavaScript}{
  keywords={typeof, new, true, false, catch, function, return, null, catch, switch, var, if, in, while, do, else, case, break},
  ndkeywords={class, export, boolean, throw, implements, import, this},
  sensitive=false,
  comment=[l]{//},
  morecomment=[s]{/*}{*/},
  morestring=[b]',
  morestring=[b]"
}

\lstset{
	% Programmeringssprog
	language=JavaScript,
	% Basal setup
	%basicstyle=\footnotesize,
	basicstyle=\scriptsize\ttfamily,
	commentstyle=\color{OneBorderGray}\bfseries,
	identifierstyle=\color{black},
	keywordstyle=\color{OneGreen}\bfseries,
	ndkeywordstyle=\color{OneGray}\bfseries,
	stringstyle=\color{OneOrange}\ttfamily,
	% Udseende
	%frame=single,
	% Linjeskfift
	breaklines,
	prebreak={\space\MyHookSign},
	tabsize=4,
	% Linjenummerering
	numbers=none,
	stepnumber=0,
	numbers=left,
	firstnumber=1,
	%numberstyle=\scriptsize,
	numberstyle=\tiny,
	% National(istiske) tegn
	extendedchars=true
}

\usepackage{ulem} % Strikethrough

\usetheme{Onecom}

%\title{Event-based programming with Node.js}
\title{One-color.js - JS color manipulation made easy}
\author{Peter Müller (@\_munter\_)}
\date{CopenhagenJS\\October 20th 2011}
%\usefonttheme{professionalfonts}
%\usenavigationsymbolstemplate{}


\begin{document}
\newcommand{\centerframe}[1]{\frame{\begin{center}#1\end{center}}}

\frame{\titlepage}

% ------ FRAME -----
\centerframe{
\frametitle{Overview}
	\texttt{whoami(1)} \vfill

	Defining ``web--server work''\vfill

	What's the problem? \vfill

	Event--based servers \vfill

	Using Node.js
}

% ------ FRAME -----
\OneGreyFrame{
\centerframe{ {\color{OneOrange}\Huge\bfseries Node.js} }
}

% ------ FRAME -----
\centerframe{
Node.js is a set of bindings to V8 JavaScript engine \par
for scripting network programs. \vfill
\flushright{\textit{--- Ryan Dahl}}
}

% ------ FRAME -----
\centerframe{
\frametitle{JavaScript}
Built for event-based programming.
\pause \vfill Think: Users clicking on fancy buttons on random web pages\ldots
%\pause \vfill \includegraphics[width=0.5\textwidth]{fig/facebook_like}
\pause \vfill (Also: ``Designed'' and implemented in 14 days\ldots)
}

\centerframe{
\frametitle{Google's V8}
Compiling (most) JavaScript to native machine code
}

\centerframe{
\frametitle{Node.js}
Provides bindings for various libraries.

\vfill Makes everything asynchronous.
}

% ------ FRAME -----
\centerframe{
	\frametitle{A single connection}
	\pause = \vfill 1 ``Event''
	\pause \vfill = \vfill 1 Closure
	\pause \vfill = \vfill 1 struct \& some pointers
	\pause \vfill + \vfill Queue of events waiting to be processed
}

% ------ FRAME -----
\begin{frame}[fragile]
\frametitle{A minimal webserver in Node.js:}
\begin{lstlisting}
// Import HTTP package
var http = require('http');

// Set up basic server
var server = http.createServer(function (req, res) {
  res.writeHead(200, {'Content-Type': 'text/plain'});
  res.end('Hello World\n');
});

// Start the server
server.listen(8124, "127.0.0.1");
console.log('Server running at http://127.0.0.1:8124/');
\end{lstlisting}
\end{frame}

% ------ FRAME -----
\begin{frame}[fragile]
\frametitle{Tricky things afoot!}
\begin{lstlisting}
var file = 'myFile.txt';
fs.readFile(file, function () {
   sys.write("Hi");
});
sys.write("BYE");
\end{lstlisting}
\pause
Outputs:

\begin{lstlisting}
BYE
HI
\end{lstlisting}

\end{frame}

% ------ FRAME -----
\begin{frame}[fragile]
\frametitle{Actual execution order}
\begin{lstlisting}
var file = 'myFile.txt';
fs.readFile(file, ... );
sys.write("BYE");
\end{lstlisting}

\pause
And when file finished loading:

\begin{lstlisting}
function () {
   sys.write("Hi");
}
\end{lstlisting}
\end{frame}

% ------ FRAME -----
\begin{frame}[fragile]
\frametitle{Writing modules}
\begin{lstlisting}
// Example.com module
function example_com(config) {
	self.config = config;
}

example_com.prototype = {
	get: function () {
	}
}
\end{lstlisting}
\end{frame}


% ------ FRAME -----
\centerframe{Gotcha's: Backtraces, package management, your habits.}

% ------ FRAME -----
\centerframe{
\frametitle{Node Advice \#1:}

Stick with 0.2 for now -- not all libraries are updated yet.
}

% ------ FRAME -----
\begin{frame}[fragile]
\frametitle{Node Advice \#2:}
\begin{lstlisting}[language=sh]
./configure --prefix=./local
make
make install
\end{lstlisting}
\end{frame}

% ------ FRAME -----
\begin{frame}[fragile]
\frametitle{Node Advice \#3:}
\begin{lstlisting}[language=sh]
curl http://npmjs.org/install.sh | sh
\end{lstlisting}
\end{frame}

\end{document}
